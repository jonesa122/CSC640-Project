<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Animal Shelter Frontend</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    input, button { margin: 0.5em 0; padding: 0.5em; }
    section { margin-bottom: 2em; }
    .animal-card { border: 1px solid #ccc; padding: 1em; margin: 1em 0; }
  </style>
</head>
<body>
  <h1>Animal Shelter Dashboard</h1>

  <section>
    <h2>Login</h2>
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button onclick="login()">Login</button>
    <p id="login-status"></p>
  </section>

  <section>
    <h2>Register</h2>
    <input type="text" id="register-username" placeholder="Username" />
    <input type="email" id="register-email" placeholder="Email" />
    <input type="password" id="register-password" placeholder="Password" />
    <button onclick="register()">Register</button>
    <p id="register-status"></p>
  </section>


  <section>
    <h2>All Animals</h2>
    <button onclick="getAnimals()">Load Animals</button>
    <div id="animal-list"></div>
  </section>

  <section>
    <h2>Get Animal by ID</h2>
    <input type="number" id="get-id" placeholder="Animal ID" />
    <button onclick="getAnimalById()">Get Animal</button>
    <div id="get-animal-result"></div>
  </section>

  <section>
    <h2>Search Animals by Attributes</h2>
    <input type="text" id="search-name" placeholder="Name" />
    <input type="text" id="search-species" placeholder="Species" />
    <input type="text" id="search-breed" placeholder="Breed" />
    <input type="number" id="search-age" placeholder="Age" />
    <select id="search-gender">
      <option value="">-- Gender --</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
    </select>
    <select id="search-status">
      <option value="">-- Status --</option>
      <option value="Available">Available</option>
      <option value="Adopted">Adopted</option>
      <option value="Fostered">Fostered</option>
      <option value="Transferred">Transferred</option>
    </select>
    <button onclick="searchByAttributes()">Search</button>
    <div id="search-attribute-results"></div>
  </section>

  <section>
    <h2>Get Adoption Request by ID</h2>
    <input type="number" id="adoption-id" placeholder="Adoption Request ID" />
    <button onclick="getAdoptionById()">Get Request</button>
    <div id="adoption-result"></div>
  </section>


  <section>
    <h2>Submit Adoption Request</h2>
    <input type="number" id="adopt-animal-id" placeholder="Animal ID" />
    <input type="text" id="adopter-name" placeholder="Name" />
    <input type="text" id="adopter-phone" placeholder="Phone" />
    <input type="email" id="adopter-email" placeholder="Email" />
    <input type="text" id="adopter-address" placeholder="Address" />
    <button onclick="submitAdoption()">Submit Adoption</button>
    <p id="adoption-status"></p>
  </section>

  <section>
    <h2>Update Adoption Request</h2>
    <input type="number" id="update-adoption-id" placeholder="Adoption Request ID" />
    <input type="date" id="update-adoption-date" placeholder="Adoption Date"/>
    <input type="text" id="update-adopter-name" placeholder="Name" />
    <input type="text" id="update-adopter-phone" placeholder="Phone" />
    <input type="email" id="update-adopter-email" placeholder="Email" />
    <input type="text" id="update-adopter-address" placeholder="Address" />
    <input type="number" id="update-animal-id" placeholder="Animal ID"/>
    <button onclick="updateAdoptionRequest()">Update Request</button>
    <p id="update-adoption-status"></p>
  </section>


  <section>
    <h2>Add New Animal</h2>
    <input type="text" id="add-name" placeholder="Name" required />
    <input type="text" id="add-species" placeholder="Species" required />
    <input type="text" id="add-breed" placeholder="Breed" required />
    <input type="number" id="add-age" placeholder="Age" required />

    <select id="add-gender" required>
      <option value="" disabled selected>-- Select Gender --</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
    </select>

    <select id="add-status" required>
      <option value="" disabled selected>-- Select Status --</option>
      <option value="Available">Available</option>
      <option value="Adopted">Adopted</option>
      <option value="Fostered">Fostered</option>
      <option value="Transferred">Transferred</option>
    </select>

    <button onclick="addAnimal()">Add Animal</button>
    <p id="add-status-msg"></p>
  </section>



  <section>
    <h2>Update Animal</h2>
    <input type="number" id="update-id" placeholder="Animal ID" />
    <input type="text" id="update-name" placeholder="Name" />
    <input type="text" id="update-species" placeholder="Species" />
    <input type="text" id="update-breed" placeholder="Breed" />
    <input type="number" id="update-age" placeholder="Age" />
    <select id="update-gender">
      <option value="">-- Select Gender --</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
    </select>
    <select id="update-status">
      <option value="">-- Select Status --</option>
      <option value="Available">Available</option>
      <option value="Adopted">Adopted</option>
      <option value="Fostered">Fostered</option>
      <option value="Transferred">Transferred</option>
    </select>
    <button onclick="updateAnimal()">Update Animal</button>
    <p id="update-status-msg"></p>
  </section>


  <section>
    <h2>Delete Animal</h2>
    <input type="number" id="delete-id" placeholder="Animal ID" />
    <button onclick="deleteAnimal()">Delete</button>
    <p id="delete-status"></p>
  </section>

  <script>
    let token = '';

    async function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      const res = await fetch('/index.php?endpoint=users&action=login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });

      const data = await res.json();
      if (data.token) {
        token = data.token;
        document.getElementById('login-status').textContent = 'Logged in!';
      } else {
        document.getElementById('login-status').textContent = 'Login failed';
      }
    }

    async function getAnimals() {
      const res = await fetch('/index.php?endpoint=animals');
      const animals = await res.json();
      const list = document.getElementById('animal-list');
      list.innerHTML = '';
      animals.forEach(animal => {
        const card = document.createElement('div');
        card.className = 'animal-card';
        card.innerHTML = `<strong>${animal.name}</strong> (ID: ${animal.id})<br>Species: ${animal.species}<br>Breed: ${animal.breed}<br>Age: ${animal.age}<br>Gender: ${animal.gender}<br>Status: ${animal.status}`;
        list.appendChild(card);
      });
    }

    async function submitAdoption() {
      const body = {
        animal_id: parseInt(document.getElementById('adopt-animal-id').value),
        adopter_name: document.getElementById('adopter-name').value,
        adopter_phone: document.getElementById('adopter-phone').value,
        adopter_email: document.getElementById('adopter-email').value,
        adopter_address: document.getElementById('adopter-address').value
      };

      const res = await fetch('/index.php?endpoint=adoptions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });

      const data = await res.json();
      document.getElementById('adoption-status').textContent = data.success ? `Adoption submitted! ID: ${data.id}` : `Error: ${data.error}`;
    }

    async function updateAnimal() {
      const id = document.getElementById('update-id').value;
      const body = {};

      const fields = [
        { key: 'name', id: 'update-name' },
        { key: 'species', id: 'update-species' },
        { key: 'breed', id: 'update-breed' },
        { key: 'age', id: 'update-age', type: 'number' },
        { key: 'gender', id: 'update-gender' },
        { key: 'status', id: 'update-status' }
      ];

      fields.forEach(field => {
        const value = document.getElementById(field.id).value;
        if (value !== '') {
          body[field.key] = field.type === 'number' ? parseInt(value) : value;
        }
      });

      const res = await fetch(`/index.php?endpoint=animals&action=update&id=${id}`, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(body)
      });

      const data = await res.json();
      document.getElementById('update-status-msg').textContent = data.success
        ? `Updated animal ID ${id}`
        : `Error: ${data.error}`;
    }


    async function deleteAnimal() {
      const id = document.getElementById('delete-id').value;

      const res = await fetch(`/index.php?endpoint=animals&action=delete&id=${id}`, {
        method: 'DELETE',
        headers: { 'Authorization': `Bearer ${token}` }
      });

      const data = await res.json();
      document.getElementById('delete-status').textContent = data.success ? `Deleted animal ID ${id}` : `Error: ${data.error}`;
    }
    async function addAnimal() {
      const body = {};
      let valid = true;

      const fields = [
        { key: 'name', id: 'add-name' },
        { key: 'species', id: 'add-species' },
        { key: 'breed', id: 'add-breed' },
        { key: 'age', id: 'add-age', type: 'number' },
        { key: 'gender', id: 'add-gender' },
        { key: 'status', id: 'add-status' }
      ];

      fields.forEach(field => {
        const value = document.getElementById(field.id).value;
        if (value === '') {
          valid = false;
          document.getElementById('add-status-msg').textContent = `Please fill out all fields.`;
        } else {
          body[field.key] = field.type === 'number' ? parseInt(value) : value;
        }
      });

      if (!valid) return;

      const res = await fetch('/index.php?endpoint=animals', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(body)
      });

      const data = await res.json();
      document.getElementById('add-status-msg').textContent = data.success
        ? `Animal added! ID: ${data.id}`
        : `Error: ${data.error}`;
    }

    async function getAnimalById() {
      const id = document.getElementById('get-id').value;
      const res = await fetch(`/index.php?endpoint=animals&id=${id}`);
      const data = await res.json();

      const result = document.getElementById('get-animal-result');
      if (data.error) {
        result.textContent = `Error: ${data.error}`;
      } else {
        result.innerHTML = `
          <div class="animal-card">
            <strong>${data.name}</strong> (ID: ${data.id})<br>
            Species: ${data.species}<br>
            Breed: ${data.breed}<br>
            Age: ${data.age}<br>
            Gender: ${data.gender}<br>
            Status: ${data.status}
          </div>
        `;
      }
    }

    async function searchByAttributes() {
      const params = new URLSearchParams();

      const fields = [
        { key: 'name', id: 'search-name' },
        { key: 'species', id: 'search-species' },
        { key: 'breed', id: 'search-breed' },
        { key: 'age', id: 'search-age' },
        { key: 'gender', id: 'search-gender' },
        { key: 'status', id: 'search-status' }
      ];

      fields.forEach(field => {
        const value = document.getElementById(field.id).value;
        if (value !== '') {
          params.append(field.key, value);
        }
      });

      const res = await fetch(`/index.php?endpoint=animals&action=search&${params.toString()}`);
      const animals = await res.json();

      const list = document.getElementById('search-attribute-results');
      list.innerHTML = '';
      if (animals.length === 0 || animals.error) {
        list.textContent = 'No animals found.';
        return;
      }

      animals.forEach(animal => {
        const card = document.createElement('div');
        card.className = 'animal-card';
        card.innerHTML = `<strong>${animal.name}</strong> (ID: ${animal.id})<br>Species: ${animal.species}<br>Breed: ${animal.breed}<br>Age: ${animal.age}<br>Gender: ${animal.gender}<br>Status: ${animal.status}`;
        list.appendChild(card);
      });
    }

    async function register() {
      const username = document.getElementById('register-username').value;
      const email = document.getElementById('register-email').value;
      const password = document.getElementById('register-password').value;

      const response = await fetch('/index.php?endpoint=users&action=register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, email, password })
      });

      const result = await response.json();
      const status = document.getElementById('register-status');
      if (response.ok) {
        status.textContent = 'Registration successful!';
        status.style.color = 'green';
      } else {
        status.textContent = result.error || 'Registration failed.';
        status.style.color = 'red';
      }
    }

    async function getAdoptionById() {
      const id = document.getElementById('adoption-id').value;
      const response = await fetch(`/index.php?endpoint=adoptions&id=${id}`);
      const result = await response.json();
      const output = document.getElementById('adoption-result');

      if (response.ok) {
        output.innerHTML = `
          <div>
            <strong>Adopter Name:</strong> ${result.adopter_name}<br>
            <strong>Adoption Date:</strong> ${result.adoption_date}<br>
            <strong>Email:</strong> ${result.adopter_email}<br>
            <strong>Phone:</strong> ${result.adopter_phone}<br>
            <strong>Address:</strong> ${result.adopter_address}<br>
            <strong>Animal ID:</strong> ${result.animal_id}
          </div>
        `;
      } else {
        output.textContent = result.error || 'Adoption request not found.';
        output.style.color = 'red';
      }
    }

    async function updateAdoptionRequest() {
      const id = document.getElementById('update-adoption-id').value;
      const name = document.getElementById('update-adopter-name').value;
      const phone = document.getElementById('update-adopter-phone').value;
      const email = document.getElementById('update-adopter-email').value;
      const address = document.getElementById('update-adopter-address').value;
      const animal = document.getElementById('update-animal-id').value;
      const date = document.getElementById('update-adoption-date').value;

      const payload = {};
      if (name) payload.adopter_name = name;
      if (phone) payload.adopter_phone = phone;
      if (email) payload.adopter_email = email;
      if (address) payload.adopter_address = address;
      if (animal) payload.animal_id = animal;
      if (date) payload.adoption_date = date;

      const response = await fetch(`/index.php?endpoint=adoptions&action=update&id=${id}`, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(payload)
      });

      const result = await response.json();
      const status = document.getElementById('update-adoption-status');
      if (response.ok) {
        status.textContent = 'Adoption request updated successfully.';
        status.style.color = 'green';
      } else {
        status.textContent = result.error || 'Update failed.';
        status.style.color = 'red';
      }
    }


  </script>
</body>
</html>